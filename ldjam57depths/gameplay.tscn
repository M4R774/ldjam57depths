[gd_scene load_steps=13 format=3 uid="uid://ddgl5xndcbusb"]

[ext_resource type="Texture2D" uid="uid://dqsjoxgpuogta" path="res://tree.png" id="1_n4psk"]
[ext_resource type="Script" uid="uid://stwto1mhsd2a" path="res://depth_of_field.gd" id="2_oe8ih"]
[ext_resource type="Script" uid="uid://651m43vi8jcq" path="res://focus_slider.gd" id="3_xuee5"]
[ext_resource type="Texture2D" uid="uid://cbuagyt2jkels" path="res://icon.svg" id="5_smepj"]

[sub_resource type="Shader" id="Shader_xuee5"]
code = "shader_type canvas_item;

uniform int strength: hint_range(1, 512) = 2;

vec4 blur_size(sampler2D tex,vec2 fragCoord, vec2 pixelSize) {
    
    vec4 color = vec4(0.,0.,0.,0.);
    float strengthFloat = float(strength);	

    vec2 pixel = fragCoord/pixelSize;
    int x_min = max(int(pixel.x-strengthFloat), 0);
    int x_max = min(int(pixel.x+strengthFloat), int(1./pixelSize.x));
    int y_min = max(int(pixel.y-strengthFloat), 0);
    int y_max = min(int(pixel.y+strengthFloat), int(1./pixelSize.y));

    int count =0;

    // Sum the pixels colors
    for(int x=x_min; x <= x_max; x++) {
        for(int y = y_min; y <= y_max; y++) {           
            color += texture(tex, vec2(float(x), float(y)) * pixelSize);
            count++;
        }
    }
    
    // Divide the color by the number of colors you summed up
    color /= float(count);
    
    return color;
}

void fragment() {	
    COLOR = blur_size(TEXTURE,UV,TEXTURE_PIXEL_SIZE);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_smepj"]
shader = SubResource("Shader_xuee5")
shader_parameter/strength = 2

[sub_resource type="Shader" id="Shader_cbffv"]
code = "shader_type canvas_item;

uniform int strength: hint_range(1, 512) = 2;

vec4 blur_size(sampler2D tex,vec2 fragCoord, vec2 pixelSize) {
    
    vec4 color = vec4(0.,0.,0.,0.);
    float strengthFloat = float(strength);	

    vec2 pixel = fragCoord/pixelSize;
    int x_min = max(int(pixel.x-strengthFloat), 0);
    int x_max = min(int(pixel.x+strengthFloat), int(1./pixelSize.x));
    int y_min = max(int(pixel.y-strengthFloat), 0);
    int y_max = min(int(pixel.y+strengthFloat), int(1./pixelSize.y));

    int count =0;

    // Sum the pixels colors
    for(int x=x_min; x <= x_max; x++) {
        for(int y = y_min; y <= y_max; y++) {           
            color += texture(tex, vec2(float(x), float(y)) * pixelSize);
            count++;
        }
    }
    
    // Divide the color by the number of colors you summed up
    color /= float(count);
    
    return color;
}

void fragment() {	
    COLOR = blur_size(TEXTURE,UV,TEXTURE_PIXEL_SIZE);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_fbudy"]
shader = SubResource("Shader_cbffv")
shader_parameter/strength = 2

[sub_resource type="Shader" id="Shader_0m7cd"]
code = "shader_type canvas_item;

uniform int strength: hint_range(1, 512) = 2;

vec4 blur_size(sampler2D tex,vec2 fragCoord, vec2 pixelSize) {
    
    vec4 color = vec4(0.,0.,0.,0.);
    float strengthFloat = float(strength);	

    vec2 pixel = fragCoord/pixelSize;
    int x_min = max(int(pixel.x-strengthFloat), 0);
    int x_max = min(int(pixel.x+strengthFloat), int(1./pixelSize.x));
    int y_min = max(int(pixel.y-strengthFloat), 0);
    int y_max = min(int(pixel.y+strengthFloat), int(1./pixelSize.y));

    int count =0;

    // Sum the pixels colors
    for(int x=x_min; x <= x_max; x++) {
        for(int y = y_min; y <= y_max; y++) {           
            color += texture(tex, vec2(float(x), float(y)) * pixelSize);
            count++;
        }
    }
    
    // Divide the color by the number of colors you summed up
    color /= float(count);
    
    return color;
}

void fragment() {	
    COLOR = blur_size(TEXTURE,UV,TEXTURE_PIXEL_SIZE);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2ihbs"]
shader = SubResource("Shader_0m7cd")
shader_parameter/strength = 2

[sub_resource type="Shader" id="Shader_1qy1k"]
code = "shader_type canvas_item;

uniform int strength: hint_range(1, 512) = 2;

vec4 blur_size(sampler2D tex,vec2 fragCoord, vec2 pixelSize) {
    
    vec4 color = vec4(0.,0.,0.,0.);
    float strengthFloat = float(strength);	

    vec2 pixel = fragCoord/pixelSize;
    int x_min = max(int(pixel.x-strengthFloat), 0);
    int x_max = min(int(pixel.x+strengthFloat), int(1./pixelSize.x));
    int y_min = max(int(pixel.y-strengthFloat), 0);
    int y_max = min(int(pixel.y+strengthFloat), int(1./pixelSize.y));

    int count =0;

    // Sum the pixels colors
    for(int x=x_min; x <= x_max; x++) {
        for(int y = y_min; y <= y_max; y++) {           
            color += texture(tex, vec2(float(x), float(y)) * pixelSize);
            count++;
        }
    }
    
    // Divide the color by the number of colors you summed up
    color /= float(count);
    
    return color;
}

void fragment() {	
    COLOR = blur_size(TEXTURE,UV,TEXTURE_PIXEL_SIZE);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_3n40r"]
shader = SubResource("Shader_1qy1k")
shader_parameter/strength = 2

[node name="Node2D" type="Control"]
layout_mode = 3
anchors_preset = 0

[node name="TreeMid" type="Sprite2D" parent="."]
material = SubResource("ShaderMaterial_smepj")
position = Vector2(611, 236)
scale = Vector2(14.25, 14.25)
texture = ExtResource("1_n4psk")
script = ExtResource("2_oe8ih")
distance_from_camera = 50.0

[node name="TreeFar" type="Sprite2D" parent="."]
texture_filter = 1
material = SubResource("ShaderMaterial_fbudy")
position = Vector2(274, 135)
scale = Vector2(8, 8)
texture = ExtResource("1_n4psk")
script = ExtResource("2_oe8ih")
distance_from_camera = 80.0

[node name="TreeClose" type="Sprite2D" parent="."]
material = SubResource("ShaderMaterial_2ihbs")
position = Vector2(823, 207)
scale = Vector2(23.1875, 23.1875)
texture = ExtResource("1_n4psk")
script = ExtResource("2_oe8ih")
distance_from_camera = 20.0

[node name="HSlider" type="HSlider" parent="."]
offset_left = 137.0
offset_top = 599.0
offset_right = 1062.0
offset_bottom = 628.0
script = ExtResource("3_xuee5")

[node name="Icon" type="Sprite2D" parent="."]
material = SubResource("ShaderMaterial_3n40r")
position = Vector2(338, 390)
texture = ExtResource("5_smepj")
script = ExtResource("2_oe8ih")
distance_from_camera = 50.0

[connection signal="value_changed" from="HSlider" to="HSlider" method="_on_value_changed"]
